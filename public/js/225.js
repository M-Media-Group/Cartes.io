(self.webpackChunksite=self.webpackChunksite||[]).push([[225],{7225:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>i});function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var a=[],r=!0,n=!1,o=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done)&&(a.push(s.value),!e||a.length!==e);r=!0);}catch(t){n=!0,o=t}finally{try{r||null==i.return||i.return()}finally{if(n)throw o}}return a}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return n(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}const s={props:["map_id","map_token","map"],components:{},data:function(){return{endpoint:"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_month.geojson",fetched_data:null,transform_parameters:{container:"features",location:{lng:"geometry.coordinates.1",lat:"geometry.coordinates.0"},category_name:"properties.title",id:"id",created_at:"properties.time",updated_at:"properties.updated"}}},mounted:function(){},computed:{first_data_point:function(){return this.transformed_data_post_container?this.transformed_data_post_container[0]:null},transformed_data_post_container:function(){if(!this.fetched_data||this.fetched_data.length<1)return null;var t=null;if(this.transform_parameters.container){if(!this.fetched_data||!this.fetched_data[this.transform_parameters.container])return null;t=this.fetched_data[this.transform_parameters.container]}else var t=this.fetched_data;return Array.isArray(t)?t.slice(0,1e3):t},transformed_data:function(){var t=this;if(!this.fetched_data||!this.transform_parameters.created_at||!this.transform_parameters.updated_at)return null;var e=this.transformed_data_post_container;return!e||e.length<1||!Array.isArray(e)?null:e.map((function(e){return{id:t.resolve(t.transform_parameters.id,e),location:{type:"Point",coordinates:[t.resolve(t.transform_parameters.location.lng,e),t.resolve(t.transform_parameters.location.lat,e)]},created_at:Vue.moment(t.resolve(t.transform_parameters.created_at,e)).format(),updated_at:Vue.moment(t.resolve(t.transform_parameters.updated_at,e)).format(),description:null,expires_at:null,category:{name:t.resolve(t.transform_parameters.category_name,e),icon:"/images/marker-01.svg"}}}))},is_valid:function(){return!(!this.transformed_data||!this.transformed_data[0])&&(!!this.transformed_data[0].location.coordinates[0]&&(!!this.transformed_data[0].location.coordinates[1]&&(!!this.transformed_data[0].id&&(!!this.transformed_data[0].category.name&&(!!this.transformed_data[0].created_at&&(!!this.transformed_data[0].updated_at&&(this.emitNewMarkers(),!0)))))))}},watch:{},created:function(){this.debouncedGetAnswer=_.debounce(this.submitForm,750)},methods:{resolve:function(t,e){if("object"!==o(e))throw"getProp: obj is not an object";if("string"!=typeof t)throw"getProp: prop is not a string";return(t=t.replace(/\[["'`](.*)["'`]\]/g,".$1")).split(".").reduce((function(t,e){return t?t[e]:void 0}),e||self)},getData:function(){var t=this;(this.endpoint.includes("incidents:7888")||this.endpoint.includes("cartes.io"))&&(this.transform_parameters={container:"",location:{lng:"location.coordinates.0",lat:"location.coordinates.1"},category_name:"category.name",id:"id",created_at:"created_at",updated_at:"created_at"}),axios.get(this.endpoint,{maxContentLength:20971520,timeout:1e4,maxRedirects:0,transformRequest:[function(t,e){return delete e.common["X-Requested-With"],delete e.common["X-CSRF-TOKEN"],delete e["X-Socket-Id"],t}]}).then((function(e){t.fetched_data=e.data})).catch((function(t){console.log(t)}))},emitNewMarkers:function(){this.$emit("markers-updated",this.transformed_data)},submitForm:function(t){var e=this;this.submit_data.loading=!0,axios.put("/api/maps/"+this.map_id,this.submit_data).then((function(t){e.submit_data.loading=!1,e.$emit("map-update",t.data)})).catch((function(t){if(e.submit_data.loading=!1,console.log(t),t.response.data.errors)var a=Object.entries(t.response.data.errors).map((function(t,e){var a=r(t,2),n=a[0],o=a[1];return"".concat(n,": ").concat(o[0]," | ")})).join("\n");else a=t.response.data.message;alert(a)}))}}};const i=(0,a(1900).Z)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 mt-5 mt-md-0"},[a("div",{key:"map-settings",staticClass:"card bg-dark text-white mb-3"},[t._m(0),t._v(" "),a("div",{staticClass:"card-body collapse",attrs:{id:"settingsImportCollapse"}},[a("div",{staticClass:"form"},[a("div",{staticClass:"form-group mx-sm-3 mb-2"},[a("label",{staticClass:"sr-only",attrs:{for:"inputPassword2"}},[t._v("API Endpoint")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.endpoint,expression:"endpoint"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"API Endpoint"},domProps:{value:t.endpoint},on:{input:function(e){e.target.composing||(t.endpoint=e.target.value)}}})]),t._v(" "),a("button",{staticClass:"btn btn-primary mb-2",attrs:{type:"url"},on:{click:function(e){return t.getData()}}},[t._v("Fetch JSON data")])]),t._v(" "),t.is_valid?a("div",{staticClass:"alert alert-success"},[t._v("All good")]):t._e(),t._v(" "),a("details",{staticClass:"mt-3 mb-3 "},[t._m(1),t._v(" "),a("div",[a("pre",{staticClass:"text-white small"},[a("code",[t._v(t._s(t.first_data_point))])])])]),t._v(" "),a("hr"),t._v(" "),a("details",{staticClass:"mt-3 mb-3 "},[t._m(2),t._v(" "),a("div",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.container,expression:"transform_parameters.container"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Container"},domProps:{value:t.transform_parameters.container},on:{input:function(e){e.target.composing||t.$set(t.transform_parameters,"container",e.target.value)}}}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.id,expression:"transform_parameters.id"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Marker ID"},domProps:{value:t.transform_parameters.id},on:{input:function(e){e.target.composing||t.$set(t.transform_parameters,"id",e.target.value)}}}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.location.lat,expression:"transform_parameters.location.lat"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Location LAT"},domProps:{value:t.transform_parameters.location.lat},on:{input:function(e){e.target.composing||t.$set(t.transform_parameters.location,"lat",e.target.value)}}}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.location.lng,expression:"transform_parameters.location.lng"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Location LNG"},domProps:{value:t.transform_parameters.location.lng},on:{input:function(e){e.target.composing||t.$set(t.transform_parameters.location,"lng",e.target.value)}}}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.category_name,expression:"transform_parameters.category_name"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Category name"},domProps:{value:t.transform_parameters.category_name},on:{input:function(e){e.target.composing||t.$set(t.transform_parameters,"category_name",e.target.value)}}}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.created_at,expression:"transform_parameters.created_at"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Created at"},domProps:{value:t.transform_parameters.created_at},on:{input:function(e){e.target.composing||t.$set(t.transform_parameters,"created_at",e.target.value)}}}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.updated_at,expression:"transform_parameters.updated_at"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Updated at"},domProps:{value:t.transform_parameters.updated_at},on:{input:function(e){e.target.composing||t.$set(t.transform_parameters,"updated_at",e.target.value)}}})])]),t._v(" "),a("hr"),t._v(" "),a("details",{staticClass:"mt-3 mb-3 "},[t._m(3),t._v(" "),a("div",[a("pre",{staticClass:"text-white small"},[t.transformed_data?a("code",[t._v(t._s(t.transformed_data[0]))]):t._e()])])])])])])])}),[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card-header",staticStyle:{cursor:"pointer"},attrs:{"data-toggle":"collapse","data-target":"#settingsImportCollapse","aria-expanded":"false","aria-controls":"settingsImportCollapse"}},[a("i",{staticClass:"fa fa-cog"}),t._v(" Data importer")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("summary",[a("dt",{staticClass:"d-inline"},[t._v("Incoming request")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("summary",[a("dt",{staticClass:"d-inline "},[t._v("Data transforming/mapping tools")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("summary",[a("dt",{staticClass:"d-inline "},[t._v("Transformed request")])])}],!1,null,null,null).exports}}]);
//# sourceMappingURL=225.js.map