"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[649],{4649:(t,a,e)=>{e.r(a),e.d(a,{default:()=>m});var r=e(9669),s=e.n(r),o=e(538);function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}const i={props:["map_id","map_token","map"],components:{},data:function(){return{endpoint:"https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_month.geojson",fetched_data:null,transform_parameters:{container:"features",location:{lng:"geometry.coordinates.1",lat:"geometry.coordinates.0"},category_name:"properties.title",id:"id",created_at:"properties.time",updated_at:"properties.updated"}}},mounted:function(){},computed:{first_data_point:function(){return this.transformed_data_post_container?this.transformed_data_post_container[0]:null},transformed_data_post_container:function(){if(!this.fetched_data||this.fetched_data.length<1)return null;var t=null;if(this.transform_parameters.container){if(!this.fetched_data||!this.fetched_data[this.transform_parameters.container])return null;t=this.fetched_data[this.transform_parameters.container]}else var t=this.fetched_data;return Array.isArray(t)?t.slice(0,1e3):t},transformed_data:function(){var t=this;if(!this.fetched_data||!this.transform_parameters.created_at||!this.transform_parameters.updated_at)return null;var a=this.transformed_data_post_container;return!a||a.length<1||!Array.isArray(a)?null:a.map((function(a){return{id:t.resolve(t.transform_parameters.id,a),location:{type:"Point",coordinates:[t.resolve(t.transform_parameters.location.lng,a),t.resolve(t.transform_parameters.location.lat,a)]},created_at:o.default.moment(t.resolve(t.transform_parameters.created_at,a)).format(),updated_at:o.default.moment(t.resolve(t.transform_parameters.updated_at,a)).format(),description:null,expires_at:null,category:{name:t.resolve(t.transform_parameters.category_name,a),icon:"/images/marker-01.svg"}}}))},is_valid:function(){return!(!this.transformed_data||!this.transformed_data[0])&&(!!this.transformed_data[0].location.coordinates[0]&&(!!this.transformed_data[0].location.coordinates[1]&&(!!this.transformed_data[0].id&&(!!this.transformed_data[0].category.name&&(!!this.transformed_data[0].created_at&&(!!this.transformed_data[0].updated_at&&(this.emitNewMarkers(),!0)))))))}},watch:{},created:function(){this.debouncedGetAnswer=window._.debounce(this.submitForm,750)},methods:{resolve:function(t,a){if("object"!==n(a))throw"getProp: obj is not an object";if("string"!=typeof t)throw"getProp: prop is not a string";return(t=t.replace(/\[["'`](.*)["'`]\]/g,".$1")).split(".").reduce((function(t,a){return t?t[a]:void 0}),a||self)},getData:function(){var t=this;(this.endpoint.includes("incidents:7888")||this.endpoint.includes("cartes.io"))&&(this.transform_parameters={container:"",location:{lng:"location.coordinates.0",lat:"location.coordinates.1"},category_name:"category.name",id:"id",created_at:"created_at",updated_at:"created_at"}),s().get(this.endpoint,{maxContentLength:20971520,timeout:1e4,maxRedirects:0,transformRequest:[function(t,a){return delete a.common["X-Requested-With"],delete a.common["X-CSRF-TOKEN"],delete a["X-Socket-Id"],delete a.common["X-Socket-ID"],t}]}).then((function(a){t.fetched_data=a.data})).catch((function(t){console.log(t)}))},emitNewMarkers:function(){this.$emit("markers-updated",this.transformed_data)},submitForm:function(t){var a=this;this.submit_data.loading=!0,s().put("/api/maps/"+this.map_id,this.submit_data).then((function(t){a.submit_data.loading=!1,a.$emit("map-update",t.data)})).catch((function(t){a.submit_data.loading=!1,console.log(t);var e="";e=t.response.data.errors?Object.entries(t.response.data.errors).map((function(t,a){var e=t[0],r=t[1];return"".concat(e,": ").concat(r[0]," | ")})).join("\n"):t.response.data.message,alert(e)}))}}};const m=(0,e(1900).Z)(i,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 mt-5 mt-md-0"},[e("div",{key:"map-settings",staticClass:"card bg-dark text-white mb-3"},[t._m(0),t._v(" "),e("div",{staticClass:"card-body collapse",attrs:{id:"settingsImportCollapse"}},[e("div",{staticClass:"form"},[e("div",{staticClass:"form-group mx-sm-3 mb-2"},[e("label",{staticClass:"sr-only",attrs:{for:"inputPassword2"}},[t._v("API Endpoint")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.endpoint,expression:"endpoint"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"API Endpoint"},domProps:{value:t.endpoint},on:{input:function(a){a.target.composing||(t.endpoint=a.target.value)}}})]),t._v(" "),e("button",{staticClass:"btn btn-primary mb-2",attrs:{type:"url"},on:{click:function(a){return t.getData()}}},[t._v("\n            Fetch JSON data\n          ")])]),t._v(" "),t.is_valid?e("div",{staticClass:"alert alert-success"},[t._v("All good")]):t._e(),t._v(" "),e("details",{staticClass:"mt-3 mb-3"},[t._m(1),t._v(" "),e("div",[e("pre",{staticClass:"text-white small"},[e("code",[t._v(t._s(t.first_data_point))])])])]),t._v(" "),e("hr"),t._v(" "),e("details",{staticClass:"mt-3 mb-3"},[t._m(2),t._v(" "),e("div",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.container,expression:"transform_parameters.container"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Container"},domProps:{value:t.transform_parameters.container},on:{input:function(a){a.target.composing||t.$set(t.transform_parameters,"container",a.target.value)}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.id,expression:"transform_parameters.id"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Marker ID"},domProps:{value:t.transform_parameters.id},on:{input:function(a){a.target.composing||t.$set(t.transform_parameters,"id",a.target.value)}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.location.lat,expression:"transform_parameters.location.lat"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Location LAT"},domProps:{value:t.transform_parameters.location.lat},on:{input:function(a){a.target.composing||t.$set(t.transform_parameters.location,"lat",a.target.value)}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.location.lng,expression:"transform_parameters.location.lng"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Location LNG"},domProps:{value:t.transform_parameters.location.lng},on:{input:function(a){a.target.composing||t.$set(t.transform_parameters.location,"lng",a.target.value)}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.category_name,expression:"transform_parameters.category_name"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Category name"},domProps:{value:t.transform_parameters.category_name},on:{input:function(a){a.target.composing||t.$set(t.transform_parameters,"category_name",a.target.value)}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.created_at,expression:"transform_parameters.created_at"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Created at"},domProps:{value:t.transform_parameters.created_at},on:{input:function(a){a.target.composing||t.$set(t.transform_parameters,"created_at",a.target.value)}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transform_parameters.updated_at,expression:"transform_parameters.updated_at"}],staticClass:"form-control",attrs:{type:"text",id:"inputPassword2",placeholder:"Updated at"},domProps:{value:t.transform_parameters.updated_at},on:{input:function(a){a.target.composing||t.$set(t.transform_parameters,"updated_at",a.target.value)}}})])]),t._v(" "),e("hr"),t._v(" "),e("details",{staticClass:"mt-3 mb-3"},[t._m(3),t._v(" "),e("div",[e("pre",{staticClass:"text-white small"},[t.transformed_data?e("code",[t._v(t._s(t.transformed_data[0]))]):t._e()])])])])])])])}),[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"card-header",staticStyle:{cursor:"pointer"},attrs:{"data-toggle":"collapse","data-target":"#settingsImportCollapse","aria-expanded":"false","aria-controls":"settingsImportCollapse"}},[e("i",{staticClass:"fa fa-cog"}),t._v(" Data importer\n      ")])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("summary",[e("dt",{staticClass:"d-inline"},[t._v("Incoming request")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("summary",[e("dt",{staticClass:"d-inline"},[t._v("Data transforming/mapping tools")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("summary",[e("dt",{staticClass:"d-inline"},[t._v("Transformed request")])])}],!1,null,null,null).exports}}]);
//# sourceMappingURL=649.js.map